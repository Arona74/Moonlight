major render helpers rewrite and cleanups